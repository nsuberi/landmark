<!DOCTYPE html>
<html>
  <head>
    <title>LandMark: Global Platform of Indigenous and Community Lands</title>
    <meta name="author" content="BlueRaster, WRI">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=7, IE=9, IE=10">
    <link rel="shortcut icon" type="image/png" href="css/images/favicon.png">
    <style>html,body{height:100%;width:100%;padding:0;margin:0;overflow:hidden}	</style>
    <link rel="stylesheet" href="css/base.css?1.1.2">
    <link rel="stylesheet" href="css/analysis.css?1.1.2">
    <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Raleway:400,600,700"><!--[if lt IE 9]>
    <script src="libs/es5-shim.min.js"></script>
    <script src="libs/es5-sham.min.js"></script>
    <script src="libs/html5shiv.js"></script><![endif]-->
  </head>
  <body class="tundra crl">
    <div class="app-body"></div>
    <p>Analysis Results </p>
    <div class="analysis-report">
      <h2 id="analysis-title"></h2><span id="analysis-body"></span>
    </div>
    <script type="text/javascript">
      console.log(window.payload);
      var tableBody = "<table id='analysisTable'><tr id='column-header'><td class='country'><b>Country</b></td><td class='name'><b>Name</b></td><td class='ident'><b>Identity</b></td><td class='offic_rec'><b>Formal Recognition</b></td><td class='rec_status'><b>Documentation Status</b></td><td class='rec_status'><b>GIS Area</b></td></tr>";
      //- var fields = ["Country", "Name", "Identity", "Formal Recognition", "Documentation Status", "Area_GIS"];
      //brApp.csv = fields.join(",") + '\n';
      
      function getTextContent(graphic, even) {
        console.log(graphic);
          if (graphic.feature.attributes.Identity === "Indigenous (self-identified)") {
              graphic.feature.attributes.Identity = "Indigenous";
          }
          if (graphic.feature.attributes.Identity === "Non-indigenous (self-identified)") {
              graphic.feature.attributes.Identity = "Community";
          }
          if (graphic.feature.attributes.Form_Rec === "Officially recognized (by law or decree)") {
              graphic.feature.attributes.Form_Rec = "Officially recognized";
          }
      
          var str;
          if (even === "even") {
              str = "<tr class='even-row'><td class='country'>" + graphic.feature.attributes.Country + "</td><td class='name'>" +
                  graphic.feature.attributes.Name + "</td><td class='ident'>" +
                  graphic.feature.attributes.Identity + "</td><td class='offic_rec'>" +
                  graphic.feature.attributes.Form_Rec + "</td><td class='rec_status'>" +
                  graphic.feature.attributes.Doc_Status + "</td><td class='rec_status'>" +
                  graphic.feature.attributes.Area_GIS + "</td></tr>";
              var fieldValues = [graphic.feature.attributes.Country, graphic.feature.attributes.Name, graphic.feature.attributes.Identity, graphic.feature.attributes.Form_Rec, graphic.feature.attributes.Form_Rec, graphic.feature.attributes.Area_GIS];
              //- brApp.csv += fieldValues.join(",") + '\n';
          } else {
              str = "<tr class='odd-row'><td>" + graphic.feature.attributes.Country + "</td><td class='name'>" +
                  graphic.feature.attributes.Name + "</td><td class='ident'>" +
                  graphic.feature.attributes.Identity + "</td><td class='offic_rec'>" +
                  graphic.feature.attributes.Form_Rec + "</td><td class='rec_status'>" +
                  graphic.feature.attributes.Doc_Status + "</td><td class='rec_status'>" +
                  graphic.feature.attributes.Area_GIS + "</td></tr>";
              var fieldValues = [graphic.feature.attributes.Country, graphic.feature.attributes.Name, graphic.feature.attributes.Identity, graphic.feature.attributes.Form_Rec, graphic.feature.attributes.Form_Rec, graphic.feature.attributes.Area_GIS];
              //- brApp.csv += fieldValues.join(",") + '\n';
          }
          return str;
      }
      
      for (var i = 0; i < window.payload.features.length; i++) {
          //if i is odd use odd row else use even row class
          if (i % 2 == 0) {
              tableBody = tableBody + getTextContent(window.payload.features[i], 'even');
          } else {
              tableBody = tableBody + getTextContent(window.payload.features[i], 'odd');
          }
      }
      
      tableBody += "</table>";
      
      document.getElementById('analysis-title').innerHTML = 'The area of interest intersects with ' + window.payload.features.length + ' indigenous and/or community lands';
      document.getElementById('analysis-body').innerHTML = tableBody;
    </script>
  </body>
</html>